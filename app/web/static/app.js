"use strict";!function(){angular.module("app",["ui.router","ui.materialize","app.modules","app.components","neteaseMusic"])}(),function(){function e(){return function(e){if(!e)return e;var t=e.replace(/(\r\n|\r|\n)/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;");return t}}angular.module("app").filter("breakFilter",e)}(),function(){angular.module("app").constant("APP_CONST",{title:"Juicy",version:"v2 alpha1",production:!0,api:"/api/"})}(),function(){function e(){}angular.module("app").controller("appCtrl",e)}(),function(){angular.module("app").factory("appEvent",["$rootScope",function(e){var t="_DATA_UPDATED_",n=function(n,i){n=n||t,i=i||{},e.$emit(n,i)},i=function(n,i,a){if(!angular.isFunction(i))return void console.log(n+": Needs a callback function");n=n||t;var o=e.$on(n,i);a&&a.$on("$destroy",o)};return{publish:n,subscribe:i}}])}(),function(){function e(e,t){function n(){return localStorage.getItem("juicy_token")}e.defaults.headers.common={Accept:"application/json, text/plain, */*","Content-Type":"application/json"},e.defaults.headers.post={},e.defaults.headers.put={},e.defaults.headers.patch={},e.interceptors.push("jwtInterceptor"),t.tokenGetter=n}e.$inject=["$httpProvider","jwtInterceptorProvider"],angular.module("app").config(e)}(),function(){function e(e,t){t.otherwise("beats"),e.state("beats",{url:"/beats",templateUrl:"partials/beats/beats.view.html",controller:"beatsCtrl",controllerAs:"vm"}).state("beats.specified",{url:"/month/:month",templateUrl:"partials/beats/beats.view.html",controller:"beatsCtrl",controllerAs:"vm"}).state("about",{url:"/about",templateUrl:"partials/about/about.view.html",controller:"aboutCtrl",controllerAs:"vm"}).state("compose",{url:"/compose",templateUrl:"partials/compose/compose.view.html",controller:"composeCtrl",controllerAs:"vm"}).state("compose-edit",{url:"/compose/:id",templateUrl:"partials/compose/compose.view.html",controller:"composeCtrl",controllerAs:"vm"}).state("login",{url:"/login",templateUrl:"partials/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).state("analysis",{url:"/analysis",templateUrl:"partials/analysis/analysis.view.html",controller:"analysisCtrl",controllerAs:"vm"}).state("topics",{url:"/topics",templateUrl:"partials/topics/topics.view.html",controller:"topicsCtrl",controllerAs:"vm"}).state("links",{url:"/links",templateUrl:"partials/links/links.view.html",controller:"linksCtrl",controllerAs:"vm"}).state("topics-detail",{url:"/topics/:id",templateUrl:"partials/topics/topics-detail.view.html",controller:"topicsDetailCtrl",controllerAs:"vm"}).state("baladeur",{url:"/baladeur",templateUrl:"partials/baladeur/baladeur.view.html",controller:"baladeurCtrl",controllerAs:"vm"})}e.$inject=["$stateProvider","$urlRouterProvider"],angular.module("app").config(e)}(),function(){function e(e,t){function n(e){return t.post("http://x.mouto.org/wb/x.php?up",e)}function i(){if(localStorage.getItem("juicy_token")){var t=e.decodeToken(localStorage.getItem("juicy_token"));if(t)return t.isAdmin}return!1}var a={uploadImage:n,isAdmin:i};return a}e.$inject=["jwtHelper","$http"],angular.module("app").service("appService",e)}(),function(){angular.module("app.components",["angularGrid","duScroll","infinite-scroll"])}(),function(){angular.module("app.modules",["angularGrid","duScroll","angular-jwt","ng-showdown","flow"])}(),function(){function e(e){function t(e,t,n,i){function a(){p.customRefreshEnabled?(p.displayedDataMirror=p.data,p.displayedData=t("filter")(p.displayedDataMirror,c)):o()}function o(){var e=!0;p.displayedData=[],g=[],m=0,s(d,e)}function r(e,t){for(var n=0;n<p.displayedData.length;n++)if(p.displayedData[n].time===t)return p.displayedData.splice(n,1),void m--}function c(e){var t,n;return null==e.featured&&(e.featured=!1),null==e.safe&&(e.safe=!0),t=!p.featuredOnly||p.featuredOnly&&e.featured,n=!p.safeOnly||p.safeOnly&&e.safe,t&&n}function s(e,t){for(var n=0;n<e;n++){if(null==p.data||null==p.data[m])return;t&&(p.data[m].init=!0),g.push(p.data[m]),c(p.data[m])?p.displayedData.push(p.data[m]):n--,m++}}function l(){p.customRefreshEnabled?p.customRefresh():s(f)}function u(e){return function(i,a){1!=a&&(a=!1),p[e]=a,n.cards.refresh(),s(f),p.displayedData=t("filter")(g,c)}}var p=this,d=p.initialCard?parseInt(p.initialCardNum,10):15,f=p.newCardPerPage?parseInt(p.newCardPerPage,10):6,m=0,g=[];p.displayedData=[],p.loadMore=l,p.featuredOnly=!1,p.safeOnly=!0,i.subscribe("toggleFeatured",u("featuredOnly"),e),i.subscribe("toggleWeired",u("safeOnly"),e),i.subscribe("deleteData",r,e),e.$watchCollection("vm.data",function(){p.data&&p.data.length&&a()},!0),e.$on("$repeatFinished",function(e,t){n.cards.refresh()})}t.$inject=["$scope","$filter","angularGridInstance","appEvent"];var n={controller:t,controllerAs:"vm",templateUrl:"components/masonry-cards/masonry-cards.view.html",scope:{data:"=jcData",initialCardNum:"@jcInitNum",newCardPerPage:"@jcRefreshNum",customRefresh:"=jcCustomRefresh",customRefreshEnabled:"=jcCustomRefreshEnabled"},bindToController:!0};return n}e.$inject=["$q"],angular.module("app.modules").directive("jcMasonryCards",e)}(),function(){function e(e){return function(t,n){var i=angular.element(e),a=function(){t.winWidth=i.width()};i.bind("resize",function(){a()}),a(),n.css("height",i.height()-20+"px")}}e.$inject=["$window"],angular.module("app.components").directive("resize",e)}(),function(){function e(e){function t(e,t,n,i){e.vm.content=i.content,e.vm.showDst=i.showDst,e.vm.utcCn=i.utcCn,e.vm.isAdmin=i.isAdmin,e.vm.hideProgress=i.hideProgress,e.vm.refreshInit()}function n(t,n){function i(){angular.isUndefined(e)||angular.isUndefined(e.cards)||!c.content.init||e.cards.refresh()}function a(e){var t=n("date")(new Date(e),"yyyy-MM-dd HH:mm:ss",o(e));return c.showDst&&(t+="+0100"===o(e)?" Winter Time":" Summer Time"),t}function o(e){if(!angular.isUndefined(e))return e=new Date(e),e>new Date(14275872e5)&&e<new Date(14457312e5)||e>new Date(13961376e5)&&e<new Date(14142816e5)?"+0200":c.utcCn?"+0800":"+0100"}var r,c=this;c.timeMessage="",c.refreshInit=i,r=t.$watch("vm.content.time",function(e){c.timeMessage=a(e),r()})}n.$inject=["$scope","$filter"];var i={controller:n,controllerAs:"vm",templateUrl:"components/card/card-content.tmpl.html",scope:{},require:"^^jcCard",link:t,bindToController:!0};return i}e.$inject=["angularGridInstance"],angular.module("app.components").directive("jcCardContent",e)}(),function(){function e(){function e(e,t,n,i){e.cardCtrl=i,e.vm.content=i.content}function t(e,t){function n(){e.cardCtrl.deleted=!0,t.publish("deleteBeats",a.content._id)}function i(){t.publish("modifyBeats",a.content)}var a=this;a.deleteBeats=n,a.modifyBeats=i}t.$inject=["$scope","appEvent"];var n={controller:t,controllerAs:"vm",templateUrl:"components/card/card-control.tmpl.html",require:"^^jcCard",scope:{},link:e,bindToController:!0};return n}angular.module("app.components").directive("jcCardControl",e)}(),function(){function e(){function e(e,t){var n=this;n.deleted=!1,n.prod=e.production,n.isAdmin=t.isAdmin()}e.$inject=["APP_CONST","appService"];var t={controller:e,controllerAs:"vm",templateUrl:"components/card/card.tmpl.html",scope:{content:"=jcContent",showDst:"@jcShowDst",utcCn:"@jcShowUtcCn",hideProgress:"@jcHideProgress"},bindToController:!0};return t}angular.module("app.components").directive("jcCard",e)}(),function(){function e(e){function t(t,n,i,a,o){function r(t){e.go(t)}var c=this;c.appTitle=o.title,c.appVersion=o.version,c.navs=i("orderBy")(t.navConfig,"order",!0),c.gotoState=r}t.$inject=["jcNav","$scope","$filter","appEvent","APP_CONST"];var n={controller:t,controllerAs:"vm",templateUrl:"components/nav/nav.tmpl.html",bindToController:!0};return n}e.$inject=["$state"],angular.module("app.components").directive("jcNav",e)}(),function(){function e(){function e(e){angular.forEach(e,function(e){t(e)})}function t(e){n.push(e)}var n=[];this.$get=function(){return{addMenu:e,navConfig:n}}}angular.module("app").provider("jcNav",e)}(),function(){function e(){function e(e,t,n,i){e.vm.settings=i.settings}function t(e){function t(t){e.publish(t.event,t.value)}var n=this;n.handleSettings=t}t.$inject=["appEvent"];var n={controller:t,controllerAs:"vm",require:"^jcSubNav",link:e,templateUrl:"components/sub-nav/sub-nav-settings.tmpl.html",bindToController:!0};return n}angular.module("app.components").directive("jcSubNavSettings",e)}(),function(){function e(){function e(e,t,n,i){e.subNavCtrl=i}function t(e,t,n,i,a){function o(){t.scrollTop(63.9,2e3)}function r(e){o(),n.go(e.state,e.stateParam),a.publish("jcSubNavSectionSwitched",e)}var c=this;c.displaySection=r,c.displaySettings=!1}t.$inject=["$rootScope","$document","$state","$scope","appEvent"];var n={controller:t,controllerAs:"vm",templateUrl:"components/sub-nav/sub-nav-tabs.tmpl.html",require:"^jcSubNav",link:e,bindToController:!0};return n}angular.module("app.components").directive("jcSubNavTabs",e)}(),function(){function e(){function e(e,t){var n=this;n.displaySettings=!1}e.$inject=["$scope","appEvent"];var t={controller:e,controllerAs:"vm",templateUrl:"components/sub-nav/sub-nav.tmpl.html",scope:{sections:"=jcSections",active:"=jcActive",settings:"=jcSettings"},bindToController:!0};return t}angular.module("app.components").directive("jcSubNav",e)}(),function(){function e(){function e(e,t,n,i,a){function o(){void 0!==l.jcTopic&&(l.jcTopicBrief||(l.jcTopic.html=t.makeHtml(l.jcTopic.content)))}function r(e){a.publish("topicSelected",{id:e})}function c(e){a.publish("editTopic",{id:e})}function s(){l.nowUrl="https://src.moe/#"+n.url(),function(t,n,i){function a(){window.open(""+o+c,"mb","toolbar=0,status=0,resizable=1,width=620,height=450,left="+(t.width-620)/2+",top="+(t.height-450)/2)||(r.href=""+o+c)}try{}catch(i){}var o="http://v.t.sina.com.cn/share/share.php?",r=e.nowUrl,c="url="+i(r)+"&title="+i(l.jcTopic.title)+"&pic="+i(l.jcTopic.thumbnail);/Firefox/.test(navigator.userAgent)?setTimeout(a,0):a()}(screen,document,encodeURIComponent)}var l=this;l.selectTopic=r,l.share=s,l.editTopic=c,l.isAdmin=i.isAdmin(),o(),e.$watch("vm.jcTopic",function(){l.jcTopic&&o()},!0)}e.$inject=["$scope","$showdown","$location","appService","appEvent"];var t={controller:e,controllerAs:"vm",scope:{jcTopic:"=",jcTopicBrief:"=",jcTopicShare:"=",jcShadowDisabled:"="},templateUrl:"components/topic-card/topic-card.view.html",bindToController:!0};return t}angular.module("app.components").directive("jcTopicCard",e)}(),function(){function e(){var e=this;e.aboutData=[{title:"Road to V2",time:1456751208e3,text:"TODO:Build up a compiling workflow with Gulp + Browserify\nTODO:Comment and tag function to add in further releases \nTODO:Music section and Anime wallpapers switch\nTODO:(V3)Analysis module to add in further releases(optional)\nTODO:(V3)Unit Tests\nTODO:(V3+)Angular 2",featured:!0},{title:"v2 alpha3",time:1468066126860,text:"Gulp, Babel, Minify",featured:!0},{title:"v2 alpha2",time:1467907913966,text:"Redis Cache , Links module",featured:!1},{title:"v2 alpha1",time:1467733803777,text:"Image Uploading , Beats and Topics editing , bug fixes",featured:!1},{title:"v2 alpha0",time:1467649952611,text:"Topic Modules with Markdown , ExpressJS Backend and UserLogin",featured:!1},{title:"AngularJS Libs",time:1456420305e3,text:"Modified Angular-materialize(including Materialize)\nModified Angular-grid by s-yadav (https://github.com/s-yadav/angulargrid)",featured:!1},{title:"About Me",time:1456420305e3,text:"Author : POJOa\nSite : http://src.moe/",featured:!1},{title:"v1.5",time:1458114983e3,text:"Multiple Bug Fixes For Recent Tab",featured:!1},{title:"v1.4.2",time:1458012771e3,text:"Ready For Express Backend\nAdded Recent Column\nThe Filter In Recent Column Currently Won't Work",featured:!1},{title:"v1.4.1",time:1457162347e3,text:"Initialization of Compose Module",featured:!1},{title:"Stable Release v1.4 (Nozomi)",time:1456751208e3,text:"Optimized performance",featured:!0},{title:"v1.4 RC1 2016.02.28",time:1456675603e3,text:"Nozomi is a Stable Version Milestone , from then I'll create a backend in express for it.\nOptimized Documentation.\nRenewed Card Style\nRefractor and Added Navbar Order\nRefresh Policy Change",featured:!1},{title:"v1.3 2016.02.25",time:1456420305e3,text:"Heavy Refractor of Card/Cards View and components\nUpdated angular-grid\nSolved various tiny bugs\n",featured:!1},{title:"v1.2 2016.02.24",time:14562432e5,text:"Refractor jcSubNav\nEnhancement of Picture Displaying\nDisabled Slider (will be taken into account after next major release)\nAdded App Drawer For Mobile Devices\n"},{title:"v1.1 2016.02.23",time:14561568e5,text:"Added Navbar Customize Configuration Provider\nAdded Event Service.\nFixed (and disabled) Card Control.\nFixed Navbar Bug , added version badge.\nMinimalized data for Github."},{title:"Release v1 2016.02.13",time:14552928e5,text:"Adjust Navbar Style.\nAdded Loading Bar.\nSpecified Feature Cards.\n",featured:!0},{title:"Pre-release 2016.02.12",time:14552064e5,text:"Fixed height issue."},{title:"v0.4 2016.02.11",time:145512e7,text:"Unlimited Refreshing! Featured Filter!!"},{title:"v0.3 2016.02.10",time:14550336e5,text:"Added Cascade Displaying , switched to UI-Router"},{title:"v0.2 2016.02.09",time:14549472e5,text:"Built Project Skeleton , added cascade displaying"},{title:"v0.1 2016.02.08",time:14548608e5,text:"Simplified JSON structure"}]}angular.module("app.modules").controller("aboutCtrl",e)}(),function(){function e(e){e.$get().addMenu([{title:"Logs",state:"about",order:3}])}e.$inject=["jcNavProvider"],angular.module("app").config(e)}(),function(){function e(e,t,n,i,a,o,r,c,s){function l(){r.fetchAll()}function u(){r.postBaladeur(b.newBaladeur).then(function(){return b.newBaladeur={createdAt:(new Date).getTime(),description:"Description goes here",genre:"Alt.Rock",image:[],emo:0,express:0,ids:[],title:"Title goes Here",artist:"Artist goes Here"}})}function p(e){b.newBaladeur=e}function d(){m()}function f(e,t,n){o.uploadImage(n.files[0].file).success(function(e){return b.newBaladeur.image[0]="http://ww4.sinaimg.cn/large/"+e.pid})}function m(){var e=b.pageForCustomRefresh*h;g&&(h=v),b.lock||(b.lock=!0,r.fetchBySkipAndLimit(e,h).success(function(e){e&&e.length?(angular.forEach(e,function(e){e.init=g,b.baladeurList||(b.baladeurList=[]),b.baladeurList.push(e)}),b.pageForCustomRefresh++,b.lock=!1):b.lock=!0,g=!1}))}var g,v,h,b=this;b.playConfig={autoPlay:!1,size:"normal",fold:!0},b.newBaladeur={createdAt:(new Date).getTime(),description:"Description goes here",genre:"Alt.Rock",image:["1.jpg"],emo:0,express:0,ids:[],title:"Title goes Here",artist:"Artist goes Here"},b.choices=[0,1,2],b.baladeurList=[],b.start=0,b.reachedEnd=!1,b.lock=!1,b.loadMore=d,b.upload=f,b.submit=u,b.edit=p,b.isAdmin=o.isAdmin(),b.pageForCustomRefresh=0,g=!0,v=3,h=3,l()}e.$inject=["$scope","$http","$state","$document","appEvent","appService","baladeurService","jwtHelper","beatsService"],angular.module("app.modules").controller("baladeurCtrl",e)}(),function(){function e(e,t){e.$get().addMenu([{title:"Baladeurâ™ª",state:"baladeur",order:10}])}e.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(e)}(),function(){function e(e,t,n,i){function a(){return e.get(i.api+"v1/baladeurs")}function o(t){return e["delete"](i.api+"v1/baladeurs/"+t)}function r(t,n){return e.get(i.api+"v1/baladeurs?sort=-time&populate=tags&&skip="+t+"&limit="+n)}function c(t){return t.emo=parseInt(t.emo,10),t.express=parseInt(t.express,10),t.ids=t.ids.map(function(e){return parseInt(e,10)}),t._id?e.patch(i.api+"v1/baladeurs/"+t._id,t):e.post(i.api+"v1/baladeurs",t)}var s={fetchAll:a,fetchBySkipAndLimit:r,deleteOne:o,postBaladeur:c};return s}e.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("baladeurService",e)}(),function(){function e(e,t,n,i,a,o,r,c,s,l){function u(){var e=B.pageForCustomRefresh*P;N&&(P=O),B.lock||(B.lock=!0,l.fetchBySkipAndLimit(e,P).success(function(e){e&&e.length?(angular.forEach(e,function(e){e.init=N,B.selectedBeats.beats||(B.selectedBeats.beats=[]),B.selectedBeats.beats.push(e)}),B.pageForCustomRefresh++,B.lock=!1):B.lock=!0,N=!1}))}function p(){i.scrollTop(0,2e3)}function d(e,t){B.newBeat=t}function f(e,t){l.deleteOne(t)}function m(e){return B.currentSelectedMonth=e,B.currentSelectedTab=g(e),l.fetchByMonth(e,1).success(function(e){B.selectedBeats=e})}function g(e){return{title:w(e),state:"beats.specified",stateParam:{month:e}}}function v(){c.fetchBySkipAndLimit(0,3).success(function(e){return B.topicList=e}),h().then(function(e){B.tabs=e,null!=n.params.month?(B.customRefreshEnabled=!1,m(n.params.month)):(B.customRefreshEnabled=!0,u())})}function h(){var e=[{title:"Recent",state:"beats"}];return l.fetchAvailableMonths().then(function(t){return angular.forEach(t.data,function(t){e.push({title:w(t),state:"beats.specified",stateParam:{month:t}})}),e})}function b(e,t){B.lock=!1,t.stateParam&&t.stateParam.month?(B.selectedBeats=[],m(t.stateParam.month),B.customRefreshEnabled=!1):(B.selectedBeats=[],B.pageForCustomRefresh=0,B.customRefreshEnabled=!0,u())}function w(e){var t=e.substring(0,2),n=e.substring(2,4);return n+"/"+t}function $(e,t){n.go("topics-detail",t)}function T(){l.postBeat(B.newBeat)}function j(e,t){n.go("compose-edit",t)}function S(e,t,n){o.uploadImage(n.files[0].file).success(function(e){return B.newBeat.image.push("http://ww4.sinaimg.cn/large/"+e.pid)})}function C(){r.fetchByName(B.newTag.name).success(function(e){e[0]&&e[0]._id?y(e[0]):r.postTag(B.newTag).success(function(e){return y(e)})})}function y(e){var t,n=!1;for(null==B.newBeat.tags&&(B.newBeat.tags=[]),t=0;t<B.newBeat.tags.length;t++)if(n=B.newBeat.tags[t]._id===e._id){B.newBeat.tags[t]=e;break}n||B.newBeat.tags.push(e),B.newTag={name:"Tag Name Goes Here","class":"blue"}}function A(e){B.newTag=angular.copy(e)}function k(e){r.deleteOne(e._id)}var B=this,P=6,O=15,N=!0;B.upload=S,B.submitBeat=T,B.addTag=C,B.modifyTag=A,B.deleteTag=k,B.newTag={name:"Tag Name Goes Here","class":"blue"},B.newBeat={text:"",featured:!1,safe:!0,tags:null},B.customRefreshEnabled=!1,B.monthNeeded=[],B.tabs=[],B.lock=!1,B.selectedBeats=[],B.currentSelectedTab={},B.jcSubNavSettings=[{type:"toggle",title:"Featured Only",value:!1,event:"toggleFeatured"},{type:"toggle",title:"Hide Selfie",value:!0,event:"toggleWeired"}],B.getBeatOfMonth=m,B.scrollTop=p,B.pushBeatsPaginated=u,B.pageForCustomRefresh=0,v(),a.subscribe("jcSubNavSectionSwitched",b,e),a.subscribe("modifyBeats",d,e),a.subscribe("deleteBeats",f,e),a.subscribe("topicSelected",$,e),a.subscribe("editTopic",j,e)}e.$inject=["$scope","$http","$state","$document","appEvent","appService","tagsService","topicsService","jwtHelper","beatsService"],angular.module("app.modules").controller("beatsCtrl",e)}(),function(){function e(e,t,n,i){function a(){return e.get(i.api+"v1/beats")}function o(t){return e["delete"](i.api+"v1/beats/"+t)}function r(t,n){return e.get(i.api+"v1/beats?sort=-time&populate=tags&&skip="+t+"&limit="+n)}function c(t,n){return e.get(i.api+"beats/yymm/"+t+"/duration/"+n)}function s(){return e.get(i.api+"beats/months")}function l(t){return t._id?e.patch(i.api+"v1/beats/"+t._id,t):e.post(i.api+"v1/beats",t)}var u={fetchAll:a,fetchByMonth:c,fetchBySkipAndLimit:r,fetchAvailableMonths:s,deleteOne:o,postBeat:l};return u}e.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("beatsService",e)}(),function(){function e(e,t,n,i,a,o,r,c){function s(){g.topicId&&r.fetchOne(g.topicId).success(function(e){return g.newTopic=e[0]})}function l(){r.postTopic(g.newTopic)}function u(e,t,n){o.uploadImage(n.files[0].file).success(function(e){return g.newTopic.content+="![image](http://ww4.sinaimg.cn/large/"+e.pid+")"})}function p(){c.fetchByName(g.newTag.name).success(function(e){e[0]&&e[0]._id?d(e[0]):c.postTag(g.newTag).success(function(e){return d(e)})})}function d(e){var t,n=!1;for(null==g.newTopic.tags&&(g.newTopic.tags=[]),t=0;t<g.newTopic.tags.length;t++)if(n=g.newTopic.tags[t]._id===e._id){g.newTopic.tags[t]=e;break}n||g.newTopic.tags.push(e),g.newTag={name:"Tag Name Goes Here","class":"blue"}}function f(e){g.newTag=angular.copy(e)}function m(e){c.deleteOne(e._id)}var g=this;g.submitTopic=l,g.upload=u,g.addTag=p,g.modifyTag=f,g.deleteTag=m,g.topicId=n.params.id,g.newTopic={title:"Topic Title Here",content:"",featured:!1,tags:[]},g.newTag={name:"Tag Name Goes Here","class":"blue"},s()}e.$inject=["$scope","$http","$state","$document","appEvent","appService","topicsService","tagsService"],angular.module("app.modules").controller("composeCtrl",e)}(),function(){function e(e,t){t.$get().isAdmin()&&e.$get().addMenu([{title:"Compose",state:"compose",order:1}])}e.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(e)}(),function(){function e(e,t,n,i){function a(){return e.get(i.api+"v1/tags")}function o(t){return e["delete"](i.api+"v1/tags/"+t)}function r(t){return e.get(i.api+'v1/tags?query={"name":"'+t+'"}')}function c(t){return e.get(i.api+"v1/tags/"+t)}function s(t){return t._id?e.patch(i.api+"v1/tags/"+t._id,t):e.post(i.api+"v1/tags",t)}var l={fetchAll:a,fetchByName:r,deleteOne:o,postTag:s,fetchById:c};return l}e.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("tagsService",e)}(),function(){function e(e,t,n,i,a,o,r,c){function s(){m.isAdmin=r.isAdmin(),c.fetchAll().success(function(e){return m.links=e})}function l(e,t,n){r.uploadImage(n.files[0].file).success(function(e){return m.newLink.img="http://ww4.sinaimg.cn/large/"+e.pid})}function u(e){i.open(e)}function p(){c.postLink(m.newLink)}function d(e){m.newLink=e}function f(e){c.deleteOne(e._id)}var m=this;m.upload=l,m.open=u,m.submit=p,m.modify=d,m.del=f,m.isAdmin=!1,m.links=[],m.newLink={title:"New Link Title",description:"Site Description",img:"Image URL",alias:"Owner's Nickname",color:"Experimental Tag Color Picker",href:"Link Goes Here"},s()}e.$inject=["$scope","$http","$state","$window","$document","appEvent","appService","linksService"],angular.module("app.modules").controller("linksCtrl",e)}(),function(){function e(e,t){e.$get().addMenu([{title:"Friends!",state:"links",order:8}])}e.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(e)}(),function(){function e(e,t,n,i){function a(){return e.get(i.api+"v1/links")}function o(t){return e["delete"](i.api+"v1/links/"+t)}function r(t,n){return e.get(i.api+"v1/links?sort=-time&skip="+t+"&limit="+n)}function c(t){return t._id?e.patch(i.api+"v1/links/"+t._id,t):e.post(i.api+"v1/links",t)}var s={fetchAll:a,fetchBySkipAndLimit:r,deleteOne:o,postLink:c};return s}e.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("linksService",e)}(),function(){function e(e,t,n,i,a,o){function r(){o.login(l.userLogin).success(c).error(function(e){return o.reg(l.userLogin).success(c)})}function c(e){"string"==typeof e&&localStorage.setItem("juicy_token",e)}function s(){o.evict()}var l=this;l.loginOrReg=r,l.evict=s,l.userLogin={username:"",password:""}}e.$inject=["$scope","$http","$state","$document","appEvent","loginService"],angular.module("app.modules").controller("loginCtrl",e)}(),function(){function e(e,t){t.$get().isAdmin()&&e.$get().addMenu([{title:"Login",state:"login",order:4}])}e.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(e)}(),function(){function e(e,t,n,i){function a(t){return e({url:i.api+"user/login",dataType:"json",method:"POST",data:t,headers:{"Content-Type":"application/json"}})}function o(t){return e({url:i.api+"user/reg",dataType:"json",method:"POST",data:t,headers:{"Content-Type":"application/json"}})}function r(){return e.get(i.api+"evictCache")}var c={login:a,reg:o,evict:r};return c}e.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("loginService",e)}(),function(){function e(e,t,n,i,a,o){function r(){s.topicId||n.go("beats"),o.fetchOne(s.topicId).success(function(e){return s.topicData=e[0]})}function c(e,t){n.go("compose-edit",t)}var s=this;s.topicData={},s.topicId=n.params.id,r(),a.subscribe("editTopic",c,e)}e.$inject=["$scope","$http","$state","$document","appEvent","topicsService"],angular.module("app.modules").controller("topicsDetailCtrl",e)}(),function(){function e(e,t,n,i,a,o){function r(){c()}function c(){var e=f.pageForCustomRefresh*d;u&&(d=p),f.lock||(f.lock=!0,o.fetchBySkipAndLimit(e,d).success(function(e){e&&e.length?(angular.forEach(e,function(e){e.init=u,f.topicList||(f.topicList=[]),f.topicList.push(e)}),f.pageForCustomRefresh++,f.lock=!1):f.lock=!0,u=!1}))}function s(e,t){n.go("topics-detail",t)}function l(e,t){n.go("compose-edit",t)}var u,p,d,f=this;f.topicList=[],f.start=0,f.reachedEnd=!1,f.lock=!1,f.loadMore=r,f.pageForCustomRefresh=0,u=!0,p=3,d=3,a.subscribe("topicSelected",s,e),a.subscribe("editTopic",l,e)}e.$inject=["$scope","$http","$state","$document","appEvent","topicsService"],angular.module("app.modules").controller("topicsCtrl",e)}(),function(){function e(e){e.$get().addMenu([{title:"Topics",state:"topics",order:5}])}e.$inject=["jcNavProvider"],angular.module("app").config(e)}(),function(){function e(e,t,n,i){function a(){return e.get(i.api+"v1/topics&populate=tags")}function o(t,n){return e.get(i.api+"v1/topics?sort=-createdAt&skip="+t+"&limit="+n+"&select=_id,title,featured,createdAt,summary,content,tags&populate=tags")}function r(t){return e.get(i.api+'v1/topics?query={"_id":"'+t+'"}&populate=tags')}function c(t,n){return e.get(i.api+"topics/yymm/"+t+"/duration/"+n)}function s(){return e.get(i.api+"topics/months")}function l(t){return t._id?e.patch(i.api+"v1/topics/"+t._id,t):e.post(i.api+"v1/topics",t)}var u={fetchAll:a,fetchByMonth:c,fetchBySkipAndLimit:o,fetchAvailableMonths:s,fetchOne:r,postTopic:l};return u}e.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("topicsService",e)}();