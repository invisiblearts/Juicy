"use strict";!function(){angular.module("app",["ui.router","app.modules","app.components","angular-matchheight","updateMeta","monospaced.elastic"])}(),function(){angular.module("app.components",["angularGrid","duScroll","infinite-scroll"])}(),function(){angular.module("app.modules",["angular-jwt","ng-showdown","flow"])}(),function(){function t(){return function(t){if(!t)return t;var e=t.replace(/(\r\n|\r|\n)/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;").replace(/ /g,"&nbsp;");return e}}angular.module("app").filter("breakFilter",t)}(),function(){angular.module("app").constant("APP_CONST",{title:"Villefranche",version:"v3",production:!0,api:"https://src.def.science/api/"})}(),function(){angular.module("updateMeta",[]),function(){function t(t,e){function n(t,e){return"["+e+'="'+t[e]+'"]'}function o(t,e){return e.filter(function(e){return t[e]}).map(function(e){return n(t,e)}).join("")}var i=["href","charset","crossorigin","hreflang","integrity","media","methods","referrerpolicy","sizes","target","title","type"];return{restrict:"E",scope:{rel:"@",href:"@",id:"@?",charset:"@?",crossorigin:"@?",hreflang:"@?",integrity:"@?",media:"@?",methods:"@?",referrerpolicy:"@?",sizes:"@?",target:"@?",title:"@?",type:"@?"},link:function(t,n,r){var a="link"+o(t,i);i.filter(function(e){return t[e]}).forEach(function(n){t.$watch(n,function(o,i){void 0!==o&&e.update(a,n,t[n])})})}}}t.$inject=["$log","updateAttribute"],angular.module("updateMeta").directive("updateLink",t)}(),function(){function t(t,e){return{restrict:"E",scope:{charset:"@",name:"@",content:"@",httpEquiv:"@",scheme:"@",property:"@",itemprop:"@"},link:function(t,n,o){var i;t.name&&(i='meta[name="'+t.name+'"]'),t.httpEquiv&&(i='meta[http-equiv="'+t.httpEquiv+'"]'),t.property&&(i='meta[property="'+t.property+'"]'),t.itemprop&&(i='meta[itemprop="'+t.itemprop+'"]'),t.$watch("content",function(n,o){void 0!==n&&e.update(i,"content",t.content)}),t.$watch("charset",function(n,o){void 0!==n&&e.update("meta[charset]","charset",t.charset)})}}}t.$inject=["$log","updateAttribute"],angular.module("updateMeta").directive("updateMeta",t)}(),function(){function t(t){return{restrict:"E",scope:{title:"@"},link:function(t,e,n){t.$watch("title",function(t,e){void 0!==t&&document&&(document.title=t)})}}}t.$inject=["$log"],angular.module("updateMeta").directive("updateTitle",t)}(),function(){function t(t){function e(e,n,o){if(!document)return void t.error("updateMeta: document is not available!");if(!e)return void t.error("updateMeta: please provide a selector");var i=document.querySelector(e);i&&i.setAttribute&&i.setAttribute(n,o)}return{update:e}}t.$inject=["$log"],angular.module("updateMeta").factory("updateAttribute",t)}()}(),function(){angular.module("app").factory("appEvent",["$rootScope","$document","$window",function(t,e,n){var o,i,r="_DATA_UPDATED_";return t.$on("$locationChangeSuccess",function(){!function(){var t,e=document.createElement("script"),n=window.location.protocol.split(":")[0];"https"===n?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()}),o=function(e,n){e=e||r,n=n||{},t.$emit(e,n)},i=function(e,n,o){if(angular.isFunction(n)){e=e||r;var i=t.$on(e,n);o&&o.$on("$destroy",i)}},{publish:o,subscribe:i}}])}(),function(){function t(t,e,n,o){function i(){return localStorage.getItem("juicy_token")}n.debugEnabled(!1),o.debugInfoEnabled(!1),t.defaults.headers.common={Accept:"application/json, text/plain, */*","Content-Type":"application/json"},t.defaults.headers.post={},t.defaults.headers.put={},t.defaults.headers.patch={},t.interceptors.push("jwtInterceptor"),e.tokenGetter=i}t.$inject=["$httpProvider","jwtInterceptorProvider","$logProvider","$compileProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n){e.html5Mode({enabled:!0}),e.hashPrefix("!"),n.otherwise("topics"),t.state("tweets",{url:"/tweets",templateUrl:"partials/beats/beats.view.html",controller:"beatsCtrl",controllerAs:"vm"}).state("tweets.specified",{url:"/month/:month",templateUrl:"partials/beats/beats.view.html",controller:"beatsCtrl",controllerAs:"vm"}).state("compose",{url:"/compose",templateUrl:"partials/compose/compose.view.html",controller:"composeCtrl",controllerAs:"vm"}).state("compose-edit",{url:"/compose/:id",templateUrl:"partials/compose/compose.view.html",controller:"composeCtrl",controllerAs:"vm"}).state("login",{url:"/login",templateUrl:"partials/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).state("analysis",{url:"/analysis",templateUrl:"partials/analysis/analysis.view.html",controller:"analysisCtrl",controllerAs:"vm"}).state("topics",{url:"/topics",templateUrl:"partials/topics/topics.view.html",controller:"topicsCtrl",controllerAs:"vm"}).state("links",{url:"/links",templateUrl:"partials/links/links.view.html",controller:"linksCtrl",controllerAs:"vm"}).state("topics-detail",{url:"/topics/:title",templateUrl:"partials/topics/topics-detail.view.html",controller:"topicsDetailCtrl",controllerAs:"vm"}).state("baladeur",{url:"/baladeur",templateUrl:"partials/baladeur/baladeur.view.html",controller:"baladeurCtrl",controllerAs:"vm"}).state("resume",{url:"/resume",templateUrl:"partials/resume/resume.view.html",controller:"resumeCtrl",controllerAs:"vm"}).state("index",{url:"/",templateUrl:"partials/topics/topics.view.html",controller:"topicsCtrl",controllerAs:"vm"})}t.$inject=["$stateProvider","$locationProvider","$urlRouterProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n,o,i,r){function a(t){r.title=t.title+" - Villefranche - 自由城 - src.moe",r.meta=t.meta}function c(t){return e.post("https://x.mouto.org/wb/x.php?up",t)}function s(){if(localStorage.getItem("juicy_token")){var e=t.decodeToken(localStorage.getItem("juicy_token"));if(e)return e.isAdmin}return!1}function u(t){return localStorage.getItem("juicy_ano_name")?localStorage.getItem("juicy_ano_name"):void localStorage.setItem("juicy_ano_name","阿卡林"+t)}function l(){var e,n=localStorage.getItem("juicy_token");return!!n&&(e=t.decodeToken(n),!!e)}function p(){var i,r=localStorage.getItem("juicy_token");return r?(i=t.decodeToken(r),e.get(n.api+"v1/users/"+i.id)):o.all("")}function d(t){i.publish("titleAndMetaVariation",t)}var m;return r.title="src.moe - POJO的个站",r.meta="POJO的个站和Blog。POJO,坐标上海,男,94年生,Web开发转读研,法语爱好者。",m={uploadImage:c,isAdmin:s,isUser:l,getCurrentUser:p,getNameRand:u,changeTitleAndMeta:d,setTitleAndMeta:a}}t.$inject=["jwtHelper","$http","APP_CONST","$q","appEvent","$rootScope"],angular.module("app").service("appService",t)}(),function(){function t(t){function e(t,e,n,o){t.vm.content=o.content,t.vm.showDst=o.showDst,t.vm.utcCn=o.utcCn,t.vm.isAdmin=o.isAdmin,t.vm.hideProgress=o.hideProgress,t.vm.refreshInit()}function n(e,n){function o(){angular.isUndefined(t)||angular.isUndefined(t.cards)||!c.content.init||t.cards.refresh()}function i(t){var e=n("date")(new Date(t),"yyyy-MM-dd",r(t));return c.showDst&&(e+="+0100"===r(t)?" Winter Time":" Summer Time"),e}function r(t){if(!angular.isUndefined(t))return t=new Date(t),t>new Date(14275872e5)&&t<new Date(14457312e5)||t>new Date(13961376e5)&&t<new Date(14142816e5)?"+0200":c.utcCn?"+0800":"+0100"}var a,c=this;c.timeMessage="",c.refreshInit=o,a=e.$watch("vm.content.time",function(t){c.timeMessage=i(t),a()})}n.$inject=["$scope","$filter"];var o={controller:n,controllerAs:"vm",templateUrl:"components/card/card-content.tmpl.html",scope:{},require:"^^jcCard",link:e,bindToController:!0};return o}t.$inject=["angularGridInstance"],angular.module("app.components").directive("jcCardContent",t)}(),function(){function t(){function t(t,e,n,o){t.cardCtrl=o,t.vm.content=o.content,t.vm.appEvent.subscribe("card_update_"+t.vm.content._id,t.vm.handleUpdate,t)}function e(t,e,n,o,i,r){function a(t){return t.user[0]?t.user[0].username:"阿卡林"}function c(){var t,e;if(f.content&&f.content.comments)for(t=f.content.comments.length>2?2:f.content.comments.length,e=0;e<t;e++)null!=f.content.comments[e]?f.commentBrief[e]=f.content.comments[e]:angular.noop}function s(){t.cardCtrl.deleted=!0,e.publish("deleteBeats",f.content._id)}function u(){e.publish("modifyBeats",f.content)}function l(){e.publish("comment",f.content)}function p(){o.postComment(f.content._id,f.newComment)}function d(t,e){f.content=e,i.cards&&i.cards.refresh()}function m(){f.showAllComments=!f.showAllComments,i.cards&&i.cards.refresh()}var f=this;f.deleteBeats=s,f.modifyBeats=u,f.submitComment=p,f.comment=l,f.commentBrief=[],f.getName=a,f.showMoreComments=m,f.showAllComments=!1,f.isUser=n.isUser(),f.isAdmin=n.isAdmin(),f.appEvent=e,f.handleUpdate=d,f.newComment={body:""},t.$watchCollection("vm.content.comments",c)}e.$inject=["$scope","appEvent","appService","beatsService","angularGridInstance","$state"];var n={controller:e,controllerAs:"vm",templateUrl:"components/card/card-control.tmpl.html",require:"^^jcCard",scope:{},link:t,bindToController:!0};return n}angular.module("app.components").directive("jcCardControl",t)}(),function(){function t(t){function e(e,n,o){t(function(){n.nivoLightbox()})}var n={link:e};return n}t.$inject=["$timeout"],angular.module("app.components").directive("lightboxed",t)}(),function(){function t(){function t(t,e,n){function o(){n.publish("comment",i.content)}var i=this;i.deleted=!1,i.prod=t.production,i.isAdmin=e.isAdmin(),i.comment=o}t.$inject=["APP_CONST","appService","appEvent"];var e={controller:t,controllerAs:"vm",templateUrl:"components/card/card.tmpl.html",scope:{content:"=jcContent",showDst:"@jcShowDst",utcCn:"@jcShowUtcCn",hideCtrl:"@jcHideCtrl",hideProgress:"@jcHideProgress"},bindToController:!0};return e}angular.module("app.components").directive("jcCard",t)}(),function(){function t(t){function e(e,n,o){t(function(){var t,e,o=n.find("nav"),i=0,r=0;n.waypoint({handler:function(t,e){"down"==e?matchMedia("only screen and (min-width: 1000px)").matches&&(n.css({height:o.outerHeight()}),o.stop().addClass("sticky").css("top",-o.outerHeight()).animate({top:i})):(n.css({height:"auto"}),o.stop().removeClass("sticky").css("top",o.outerHeight()+r).animate({top:""},0))},offset:function(){return-o.outerHeight()-r}}),t=n.find("section"),e=n.find("nav a"),t.waypoint({handler:function(t,o){var i,r=n;"up"===o&&(r=r.prev()),i=n.find('nav a[href="#'+r.attr("id")+'"]'),e.removeClass("selected"),i.addClass("selected")},offset:"95%"},function(){$.waypoints("refresh")})})}var n={link:e};return n}t.$inject=["$timeout"],angular.module("app.components").directive("sticky",t)}(),function(){function t(t){function e(t,e,n,o,i,r,a){function c(t){r.go(t)}var s=this;s.state=r,s.appTitle=i.title,s.appVersion=i.version,s.navs=n("orderBy")(t.navConfig,"order",!0),s.gotoState=c}e.$inject=["jcNav","$scope","$filter","appEvent","APP_CONST","$state","$rootScope"];var n={controller:e,controllerAs:"vm",templateUrl:"components/nav/nav.tmpl.html",bindToController:!0};return n}t.$inject=["$state"],angular.module("app.components").directive("jcNav",t)}(),function(){function t(){function t(t){angular.forEach(t,function(t){e(t)})}function e(t){n.push(t)}var n=[];this.$get=function(){return{addMenu:t,navConfig:n}}}angular.module("app").provider("jcNav",t)}(),function(){function t(t){function e(t,e,n,o){function i(){p.customRefreshEnabled?(p.displayedDataMirror=p.data,p.displayedData=e("filter")(p.displayedDataMirror,c)):r()}function r(){var t=!0;p.displayedData=[],g=[],f=0,s(d,t)}function a(t,e){for(var n=0;n<p.displayedData.length;n++)if(p.displayedData[n].time===e)return p.displayedData.splice(n,1),void f--}function c(t){var e,n;return null==t.featured&&(t.featured=!1),null==t.safe&&(t.safe=!0),e=!p.featuredOnly||p.featuredOnly&&t.featured,n=!p.safeOnly||p.safeOnly&&t.safe,e&&n}function s(t,e){for(var n=0;n<t;n++){if(null==p.data||null==p.data[f])return;e&&(p.data[f].init=!0),g.push(p.data[f]),c(p.data[f])?p.displayedData.push(p.data[f]):n--,f++}}function u(){p.customRefreshEnabled?p.customRefresh():s(m)}function l(t){return function(o,i){1!=i&&(i=!1),p[t]=i,n.cards.refresh(),s(m),p.displayedData=e("filter")(g,c)}}var p=this,d=p.initialCard?parseInt(p.initialCardNum,10):15,m=p.newCardPerPage?parseInt(p.newCardPerPage,10):6,f=0,g=[];p.displayedData=[],p.loadMore=u,p.featuredOnly=!1,p.safeOnly=!0,o.subscribe("toggleFeatured",l("featuredOnly"),t),o.subscribe("toggleWeired",l("safeOnly"),t),o.subscribe("deleteData",a,t),t.$watchCollection("vm.data",function(){p.data&&p.data.length&&i()},!0),t.$on("$repeatFinished",function(t,e){n.cards.refresh()})}e.$inject=["$scope","$filter","angularGridInstance","appEvent"];var n={controller:e,controllerAs:"vm",templateUrl:"components/masonry-cards/masonry-cards.view.html",scope:{data:"=jcData",initialCardNum:"@jcInitNum",newCardPerPage:"@jcRefreshNum",customRefresh:"=jcCustomRefresh",customRefreshEnabled:"=jcCustomRefreshEnabled"},bindToController:!0};return n}t.$inject=["$q"],angular.module("app.modules").directive("jcMasonryCards",t)}(),function(){function t(t){return function(e,n){var o=angular.element(t),i=function(){e.winWidth=o.width()};o.bind("resize",function(){i()}),i()}}t.$inject=["$window"],angular.module("app.components").directive("resize",t)}(),function(){function t(){function t(t,e,n,o){t.vm.settings=o.settings}function e(t){function e(e){t.publish(e.event,e.value)}var n=this;n.handleSettings=e}e.$inject=["appEvent"];var n={controller:e,controllerAs:"vm",require:"^jcSubNav",link:t,templateUrl:"components/sub-nav/sub-nav-settings.tmpl.html",bindToController:!0};return n}angular.module("app.components").directive("jcSubNavSettings",t)}(),function(){function t(){function t(t,e,n,o){t.subNavCtrl=o}function e(t,e,n,o,i){function r(){e.scrollTop(63.9,2e3)}function a(t){r(),n.go(t.state,t.stateParam),i.publish("jcSubNavSectionSwitched",t)}var c=this;c.displaySection=a,c.displaySettings=!1,o.$watch("subNavCtrl.sections",function(){o.subNavCtrl.sections.length>1&&(c.reload=!0)})}e.$inject=["$rootScope","$document","$state","$scope","appEvent"];var n={controller:e,controllerAs:"vm",templateUrl:"components/sub-nav/sub-nav-tabs.tmpl.html",require:"^jcSubNav",link:t,bindToController:!0};return n}angular.module("app.components").directive("jcSubNavTabs",t)}(),function(){function t(){function t(t,e){var n=this;n.displaySettings=!1}t.$inject=["$scope","appEvent"];var e={controller:t,controllerAs:"vm",templateUrl:"components/sub-nav/sub-nav.tmpl.html",scope:{sections:"=jcSections",active:"=jcActive",settings:"=jcSettings"},bindToController:!0};return e}angular.module("app.components").directive("jcSubNav",t)}(),function(){function t(){function t(t,e,n,o,i,r,a){function c(){if(i.getCurrentUser().then(function(t){return m.currentUser=t.data}),void 0!==m.jcTopic&&!m.jcTopicBrief){var t=e.makeHtml(m.jcTopic.content);m.jcTopic.html=o.trustAsHtml(t)}}function s(t){r.publish("topicSelected",{title:t})}function u(t){r.publish("editTopic",{id:t})}function l(){m.nowUrl="https://src.moe/#"+n.url(),function(t,e,n){function o(){window.open(""+i+a,"mb","toolbar=0,status=0,resizable=1,width=620,height=450,left="+(t.width-620)/2+",top="+(t.height-450)/2)||(r.href=""+i+a)}try{}catch(n){}var i="http://v.t.sina.com.cn/share/share.php?",r=m.nowUrl,a="url="+n(r)+"&title="+n(m.jcTopic.title)+"&pic="+n(m.jcTopic.thumbnail);/Firefox/.test(navigator.userAgent)?setTimeout(o,0):o()}(screen,document,encodeURIComponent)}function p(t,e,n){i.uploadImage(n.files[0].file).success(function(t){m.currentUser.avatar="https://ws4.sinaimg.cn/large/"+t.pid,a.updateUser(m.currentUser).then(c())})}function d(t){return t&&t._id&&m.currentUser&&m.currentUser._id&&t._id==m.currentUser._id}var m=this;m.selectTopic=s,m.share=l,m.editTopic=u,m.isAdmin=i.isAdmin(),m.isUser=i.isUser(),m.checkSelf=d,m.upload=p,c(),t.$watch("vm.jcTopic",function(){m.jcTopic&&c()},!0)}t.$inject=["$scope","$showdown","$location","$sce","appService","appEvent","loginService"];var e={controller:t,controllerAs:"vm",scope:{jcTopic:"=",jcTopicBrief:"=",jcTopicShare:"=",jcShadowDisabled:"="},templateUrl:"components/topic-card/topic-card.view.html",bindToController:!0};return e}angular.module("app.components").directive("jcTopicCard",t)}(),function(){function t(){}angular.module("app.modules").controller("baladeurCtrl",t)}(),function(){function t(t,e){t.$get().addMenu([{title:"🎸🎵",state:"baladeur",order:10}])}t.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n,o,i,r,a,c,s,u){function l(){var t=N.pageForCustomRefresh*M;I&&(M=O),N.lock||(N.lock=!0,c.fetchBySkipAndLimit(t,M).success(function(t){t&&t.length?(angular.forEach(t,function(t){t.init=I,N.selectedBeats.beats||(N.selectedBeats.beats=[]),N.selectedBeats.beats.push(t)}),N.pageForCustomRefresh++,N.lock=!1):N.lock=!0,I=!1}))}function p(){n.scrollTop(0,2e3)}function d(t,e){N.newBeat=e,N.newBeat.image&&N.newBeat.image.length&&(N.newBeat.image=N.newBeat.image.map(function(t){return t.replace("https://ww4","https://ws4")}))}function m(t,e){c.deleteOne(e)}function f(t){return N.currentSelectedMonth=t,N.currentSelectedTab=g(t),c.fetchByMonth(t,1).success(function(t){N.selectedBeats=t})}function g(t){return{title:y(t),state:"beats.specified",stateParam:{month:t}}}function h(){N.newBeat={text:"",featured:!1,safe:!0,tags:[]}}function v(){N.isUser=i.isUser(),i.getCurrentUser().then(function(t){return N.currentUser=t.data}),a.fetchBySkipAndLimit(0,3).success(function(t){return N.topicList=t}),w().then(function(t){N.tabs=t,null!=e.params.month?(N.customRefreshEnabled=!1,f(e.params.month)):(N.currentSelectedTab={title:"Recent",state:"beats"},N.customRefreshEnabled=!0,l())})}function b(t){"string"==typeof t&&localStorage.setItem("juicy_token",t),i.getCurrentUser().then(function(t){N.currentUser=t.data;var e=angular.copy(N.newComment.beat);if(N.newComment.body&&""!==N.newComment.body)return delete N.newComment.beat,c.postComment(e,N.newComment).success(function(t){return o.publish("card_update_"+e,t)})})}function w(){var t=[{title:"Recent",state:"beats"}];return c.fetchAvailableMonths().then(function(e){return angular.forEach(e.data,function(e){t.push({title:y(e),state:"beats.specified",stateParam:{month:e}})}),t})}function $(t,e){N.currentSelectedTab=e,N.lock=!1,e.stateParam&&e.stateParam.month?(N.selectedBeats=[],f(e.stateParam.month),N.customRefreshEnabled=!1):(N.selectedBeats=[],N.pageForCustomRefresh=0,N.customRefreshEnabled=!0,l())}function y(t){var e=t.substring(0,2),n=t.substring(2,4);return n+"/"+e}function C(t,n){e.go("topics-detail",n)}function j(){e.go("login")}function T(){c.postBeat(N.newBeat)}function S(t,n){e.go("compose-edit",n)}function A(t,e){N.newComment={},N.newComment.beat=e._id}function k(t,e,n){i.uploadImage(n.files[0].file).success(function(t){N.newBeat.image||(N.newBeat.image=[]),N.newBeat.image.push("https://ws4.sinaimg.cn/large/"+t.pid)})}function U(){r.fetchByName(N.newTag.name).success(function(t){t[0]&&t[0]._id?_(t[0]):r.postTag(N.newTag).success(function(t){return _(t)})})}function _(t){var e,n=!1;for(null==N.newBeat.tags&&(N.newBeat.tags=[]),e=0;e<N.newBeat.tags.length;e++)if(n=N.newBeat.tags[e]._id===t._id){N.newBeat.tags[e]=t;break}n||N.newBeat.tags.push(t),N.newTag={name:"Tag Name Goes Here","class":"blue"}}function P(t){N.newTag=angular.copy(t)}function B(t){r.deleteOne(t._id)}function D(){E(N.currentUser&&N.currentUser._id?N.currentUser:N.userLogin)}function E(t){u.login(t).success(b).error(function(e){return u.reg(t).success(b)})}var N=this,M=1,O=3,I=!0;N.isAdmin=i.isAdmin(),N.upload=k,N.submitBeat=T,N.addTag=U,N.clearCurrentBeat=h,N.modifyTag=P,N.deleteTag=B,N.newComment={},N.newTag={name:"Tag Name Goes Here","class":"blue"},N.newBeat={text:"",featured:!1,safe:!0,tags:[]},N.login=j,N.customRefreshEnabled=!1,N.monthNeeded=[],N.tabs=[],N.lock=!1,N.selectedBeats=[],N.currentSelectedTab={},N.jcSubNavSettings=[{type:"toggle",title:"Featured Only",value:!1,event:"toggleFeatured"},{type:"toggle",title:"Hide Selfie",value:!0,event:"toggleWeired"}],N.userLogin={username:"",password:""},N.getBeatOfMonth=f,N.scrollTop=p,N.pushBeatsPaginated=l,N.submitComment=D,N.pageForCustomRefresh=0,v(),o.subscribe("jcSubNavSectionSwitched",$,t),o.subscribe("modifyBeats",d,t),o.subscribe("deleteBeats",m,t),o.subscribe("topicSelected",C,t),o.subscribe("editTopic",S,t),o.subscribe("comment",A,t)}t.$inject=["$scope","$state","$document","appEvent","appService","tagsService","topicsService","beatsService","$q","loginService"],angular.module("app.modules").controller("beatsCtrl",t)}(),function(){function t(t,e){t.$get().addMenu([{title:"造句",state:"tweets",order:12}])}t.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n,o){function i(){return t.get(o.api+"v1/beats")}function r(e){return t["delete"](o.api+"v1/beats/"+e)}function a(e,n){return t.get(o.api+'v1/beats?sort=-time&populate=[{"path":"tags"},{"path":"comments","populate":{"path":"user"}}]&skip='+e+"&limit="+n)}function c(e,n){return t.get(o.api+"beats/yymm/"+e+"/duration/"+n)}function s(){return t.get(o.api+"beats/months")}function u(e){return e._id?t.patch(o.api+"v1/beats/"+e._id,e):t.post(o.api+"v1/beats",e)}function l(e,n){return t.post(o.api+"beats/"+e+"/comment",n)}var p={fetchAll:i,fetchByMonth:c,fetchBySkipAndLimit:a,fetchAvailableMonths:s,deleteOne:r,postBeat:u,postComment:l};return p}t.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("beatsService",t)}(),function(){function t(t,e,n,o,i,r,a,c){function s(){h.topicId&&a.fetchOne(h.topicId).success(function(t){return h.newTopic=t[0]})}function u(){a.postTopic(h.newTopic)}function l(t,e,n){r.uploadImage(n.files[n.files.length-1].file).success(function(t){return h.newTopic.content+="![image](https://ws4.sinaimg.cn/large/"+t.pid+")"})}function p(){c.fetchByName(h.newTag.name).success(function(t){t[0]&&t[0]._id?d(t[0]):c.postTag(h.newTag).success(function(t){return d(t)})})}function d(t){var e,n=!1;for(null==h.newTopic.tags&&(h.newTopic.tags=[]),e=0;e<h.newTopic.tags.length;e++)if(n=h.newTopic.tags[e]._id===t._id){h.newTopic.tags[e]=t;break}n||h.newTopic.tags.push(t),h.newTag={name:"","class":""}}function m(t){h.newTag=angular.copy(t)}function f(t){c.deleteOne(t._id)}function g(t){a.del(t)}var h=this;h.submitTopic=u,h.upload=l,h.addTag=p,h.del=g,h.modifyTag=m,h.deleteTag=f,h.topicId=n.params.id,h.newTopic={title:"",content:"",featured:!1,tags:[]},h.newTag={name:"","class":"blue"},s()}t.$inject=["$scope","$http","$state","$document","appEvent","appService","topicsService","tagsService"],angular.module("app.modules").controller("composeCtrl",t)}(),function(){function t(t,e){e.$get().isAdmin()&&t.$get().addMenu([{title:"写文",state:"compose",order:2}])}t.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n,o){function i(){return t.get(o.api+"v1/tags")}function r(e){return t["delete"](o.api+"v1/tags/"+e)}function a(e){return t.get(o.api+'v1/tags?query={"name":"'+e+'"}')}function c(e){return t.get(o.api+"v1/tags/"+e)}function s(e){return e._id?t.patch(o.api+"v1/tags/"+e._id,e):t.post(o.api+"v1/tags",e)}var u={fetchAll:i,fetchByName:a,deleteOne:r,postTag:s,fetchById:c};return u}t.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("tagsService",t)}(),function(){function t(t,e,n,o,i,r,a,c){function s(){f.isAdmin=a.isAdmin(),c.fetchAll().success(function(t){return f.links=t})}function u(t,e,n){a.uploadImage(n.files[0].file).success(function(t){return f.newLink.img="https://ws4.sinaimg.cn/large/"+t.pid})}function l(t){o.open(t)}function p(){c.postLink(f.newLink)}function d(t){f.newLink=t}function m(t){c.deleteOne(t._id)}var f=this;f.upload=u,f.open=l,f.submit=p,f.modify=d,f.del=m,f.isAdmin=!1,f.links=[],f.newLink={title:"New Link Title",description:"Site Description",img:"Image URL",alias:"Owner's Nickname",color:"Experimental Tag Color Picker",href:"Link Goes Here"},s()}t.$inject=["$scope","$http","$state","$window","$document","appEvent","appService","linksService"],angular.module("app.modules").controller("linksCtrl",t)}(),function(){function t(t,e){t.$get().addMenu([{title:"友链",state:"links",order:11}])}t.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n,o){function i(){return t.get(o.api+"v1/links")}function r(e){return t["delete"](o.api+"v1/links/"+e)}function a(e,n){return t.get(o.api+"v1/links?sort=-time&skip="+e+"&limit="+n)}function c(e){return e._id?t.patch(o.api+"v1/links/"+e._id,e):t.post(o.api+"v1/links",e)}var s={fetchAll:i,fetchBySkipAndLimit:a,deleteOne:r,postLink:c};return s}t.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("linksService",t)}(),function(){function t(t,e,n,o,i,r,a,c){function s(){c.getCurrentUser().then(function(t){return f.currentUser=t.data})}function u(){f.userLogin&&f.userLogin.username&&""!==f.userLogin.username&&f.userLogin.password&&""!==f.userLogin.password&&a.login(f.userLogin).success(l).error(function(t){return a.reg(f.userLogin).success(l)})}function l(t){"string"==typeof t&&localStorage.setItem("juicy_token",t),s()}function p(t,e,n){c.uploadImage(n.files[0].file).success(function(t){return f.currentUser.avatar="https://ws4.sinaimg.cn/large/"+t.pid})}function d(){a.evict()}function m(){a.updateUser(f.currentUser)}var f=this;f.loginOrReg=u,f.evict=d,f.userLogin={username:"",password:""},f.currentUser={},f.updateUser=m,f.upload=p,s()}t.$inject=["$scope","$http","$state","$document","appEvent","jwtHelper","loginService","appService"],angular.module("app.modules").controller("loginCtrl",t)}(),function(){function t(t,e){t.$get().addMenu([{title:"登录",state:"login",order:1}])}t.$inject=["jcNavProvider","appServiceProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n,o){function i(e){return t({url:o.api+"user/login",dataType:"json",method:"POST",data:e,headers:{"Content-Type":"application/json"}})}function r(e){return t({url:o.api+"user/reg",dataType:"json",method:"POST",data:e,headers:{"Content-Type":"application/json"}})}function a(e){return t.patch(o.api+"v1/users/"+e._id,e)}function c(){return t.get(o.api+"evictCache")}var s={login:i,reg:r,evict:c,updateUser:a};return s}t.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("loginService",t)}(),function(){function t(){}angular.module("app.modules").controller("resumeCtrl",t)}(),function(){function t(t){t.$get().addMenu([{title:"自述",state:"resume",order:14}])}t.$inject=["jcNavProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n,o,i,r,a,c){function s(){f.isUser=r.isUser(),r.getCurrentUser().then(function(t){return f.currentUser=t.data}),f.topicTitle?RegExp(".*[一-龥 ]+.*$","g").test(f.topicTitle)?a.fetchByTitle(f.topicTitle).success(function(t){f.topicData=t[0],f.topicData.tagText=f.topicData.tags.map(function(t){return t.name}).join(","),f.topicData&&f.topicData._id||n.go("topics")}).error(function(t){return n.go("topics")}):a.fetchOne(f.topicTitle).success(function(t){f.topicData=t[0],f.topicData.tagText=f.topicData.tags.map(function(t){return t.name}).join(","),f.topicData&&f.topicData._id||n.go("topics")}).error(function(t){return a.fetchByTitle(f.topicTitle).success(function(t){f.topicData=t[0],f.topicData.tagText=f.topicData.tags.map(function(t){return t.name}).join(","),f.topicData&&f.topicData._id||n.go("topics")}).error(function(t){return n.go("topics")})}):n.go("topics")}function u(t,e){n.go("compose-edit",e)}function l(){p(f.currentUser&&f.currentUser._id?f.currentUser:f.userLogin)}function p(t){o.login(t).success(d).error(function(e){return o.reg(t).success(d)})}function d(t){"string"==typeof t&&localStorage.setItem("juicy_token",t),r.getCurrentUser().then(function(t){if(f.currentUser=t.data,f.newComment&&f.newComment.body&&""!==f.newComment.body)return a.postComment(f.topicData._id,f.newComment).success(function(t){return f.topicData=t})})}function m(){n.go("login")}var f=this;f.topicData={},f.topicTitle=n.params.title,f.userLogin={username:"",password:""},f.submitComment=l,f.isUser=r.isUser(),f.login=m,s(),i.subscribe("editTopic",u,t)}t.$inject=["$scope","$http","$state","loginService","appEvent","appService","topicsService","$q"],angular.module("app.modules").controller("topicsDetailCtrl",t)}(),function(){function t(t,e,n,o,i,r){function a(){c()}function c(){var t=m.pageForCustomRefresh*d;l&&(d=p),m.lock||(m.lock=!0,r.fetchBySkipAndLimit(t,d).success(function(t){t&&t.length?(angular.forEach(t,function(t){t.init=l,m.topicList||(m.topicList=[]),m.topicList.push(t)}),m.pageForCustomRefresh++,m.lock=!1):m.lock=!0,l=!1}))}function s(t,e){n.go("topics-detail",e)}function u(t,e){n.go("compose-edit",e)}var l,p,d,m=this;m.topicList=[],m.start=0,m.reachedEnd=!1,m.lock=!1,m.loadMore=a,m.pageForCustomRefresh=0,l=!0,p=3,d=3,i.subscribe("topicSelected",s,t),i.subscribe("editTopic",u,t)}t.$inject=["$scope","$http","$state","$document","appEvent","topicsService"],angular.module("app.modules").controller("topicsCtrl",t)}(),function(){function t(t){t.$get().addMenu([{title:"作文",state:"topics",order:13}])}t.$inject=["jcNavProvider"],angular.module("app").config(t)}(),function(){function t(t,e,n,o){function i(){return t.get(o.api+"v1/topics&populate=tags&staticType=null")}function r(e){return t["delete"](o.api+"v1/topics/"+e)}function a(e,n){return t.get(o.api+"v1/topics?sort=-createdAt&skip="+e+"&limit="+n+'&select=_id,title,featured,createdAt,summary,content,thumbnail,tags,staticType&populate=tags&query={"staticType":{"$ne":"draft"}}')}function c(e){return t.get(o.api+'v1/topics?query={"_id":"'+e+'"}&populate=[{"path":"tags"},{"path":"comments","populate":{"path":"user"}}]')}function s(e){return t.get(o.api+'v1/topics?query={"title":"'+e+'"}&populate=[{"path":"tags"},{"path":"comments","populate":{"path":"user"}}]')}function u(e,n){return t.get(o.api+"topics/yymm/"+e+"/duration/"+n)}function l(){return t.get(o.api+"topics/months")}function p(e){return e._id?t.patch(o.api+"v1/topics/"+e._id,e):t.post(o.api+"v1/topics",e)}function d(e,n){return t.post(o.api+"topic/"+e+"/comment",n)}function m(e){return t.get(o.api+'v1/topics?query={"staticType":"'+e+'"}&populate=[{"path":"tags"},{"path":"comments","populate":{"path":"user"}}]')}var f={fetchAll:i,fetchByMonth:u,fetchBySkipAndLimit:a,fetchAvailableMonths:l,fetchOne:c,postTopic:p,postComment:d,findOneByStaticType:m,fetchByTitle:s,del:r};return f}t.$inject=["$http","$state","$document","APP_CONST"],angular.module("app.modules").service("topicsService",t)}();